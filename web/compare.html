<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>产品对比 - 农产品供销信息平台</title>
    <!-- 引入字体图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- 引入基础样式 -->
    <link rel="stylesheet" href="../app/css/style.css">
    <!-- 引入Web端通用样式 -->
    <link rel="stylesheet" href="css/web-style.css">
    <!-- 引入对比页面特有样式 -->
    <link rel="stylesheet" href="css/compare-web.css">
    <!-- 页面描述 -->
    <meta name="description" content="农产品对比页面，对比多个农产品的详细信息和参数">
    <!-- 主题色 -->
    <meta name="theme-color" content="#2E8B57">
</head>

<body>
    <div class="app-container">
        <!-- Web端顶部导航栏 -->
        <header class="web-header">
            <div class="web-header-container">
                <!-- 左侧Logo -->
                <div class="web-logo">
                    <img src="images/logo.png" alt="农产品供销信息平台" class="logo-image">
                    <span class="logo-text">农产品供销信息平台</span>
                </div>

                <!-- 中间导航链接 -->
                <nav class="web-nav">
                    <a href="index.html" class="web-nav-link" data-page="index">首页</a>
                    <a href="javascript:void(0)" class="web-nav-link" id="trade-hall-link">交易大厅</a>
                    <a href="publish.html" class="web-nav-link" data-page="publish">发布信息</a>
                    <a href="user.html" class="web-nav-link" data-page="user">个人中心</a>
                </nav>

                <!-- 右侧用户区域 -->
                <div class="web-user-area">
                    <a href="login.html" class="login-btn" id="loginBtn">登录</a>
                    <a href="user.html" class="user-avatar-mini" id="userAvatarMini" style="display: none;">
                        <img src="../app/images/default-avatar.png" alt="用户头像" id="userAvatarImg">
                    </a>
                </div>
            </div>
        </header>

        <!-- 侧边栏菜单 -->
        <aside class="sidebar">
            <div class="sidebar-container">
                <div class="sidebar-header">
                    <img src="images/logo.png" alt="Logo" class="sidebar-logo">
                    <span class="sidebar-title">农产品供销平台</span>
                </div>

                <nav class="sidebar-menu">
                    <a href="index.html" class="sidebar-menu-item" data-page="index">
                        <i class="fas fa-home"></i>首页
                    </a>
                    <a href="javascript:void(0)" class="sidebar-menu-item" id="sidebar-trade-hall-link">
                        <i class="fas fa-building"></i>交易大厅
                    </a>
                    <a href="publish.html" class="sidebar-menu-item" data-page="publish">
                        <i class="fas fa-plus-circle"></i>发布信息
                    </a>
                    <a href="user.html" class="sidebar-menu-item" data-page="user">
                        <i class="fas fa-user"></i>个人中心
                    </a>
                </nav>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <div class="content-header">
                <h1 class="page-title">产品对比</h1>
                <a href="javascript:history.back()" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    <span>返回</span>
                </a>
            </div>

            <!-- 对比内容区域 -->
            <section class="compare-container">
                <div class="compare-notice" id="compareNotice">
                    <i class="fas fa-info-circle"></i>
                    <span>正在加载产品对比数据...</span>
                </div>

                <!-- 对比表格区域 -->
                <div class="compare-table-wrapper" id="compareTableWrapper" style="display: none;">
                    <div class="compare-table-container">
                        <table class="compare-table" id="compareTable">
                            <thead>
                                <tr>
                                    <th class="property-header">参数</th>
                                    <!-- 产品列将由JavaScript动态添加 -->
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 基本信息 -->
                                <tr class="category-header">
                                    <td colspan="5">基本信息</td>
                                </tr>
                                <tr>
                                    <td class="property-name">产品</td>
                                    <!-- 产品数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">图片</td>
                                    <!-- 产品图片将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">价格</td>
                                    <!-- 价格数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">卖家</td>
                                    <!-- 卖家数据将由JavaScript动态添加 -->
                                </tr>

                                <!-- 产品属性 -->
                                <tr class="category-header">
                                    <td colspan="5">产品属性</td>
                                </tr>
                                <tr>
                                    <td class="property-name">产地</td>
                                    <!-- 产地数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">规格</td>
                                    <!-- 规格数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">库存</td>
                                    <!-- 库存数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">起订量</td>
                                    <!-- 起订量数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">供应周期</td>
                                    <!-- 供应周期数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">发货地</td>
                                    <!-- 发货地数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">更新时间</td>
                                    <!-- 更新时间数据将由JavaScript动态添加 -->
                                </tr>

                                <!-- 其他属性 -->
                                <tr class="category-header">
                                    <td colspan="5">其他信息</td>
                                </tr>
                                <tr>
                                    <td class="property-name">产品描述</td>
                                    <!-- 产品描述数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">认证标签</td>
                                    <!-- 认证标签数据将由JavaScript动态添加 -->
                                </tr>
                                <tr>
                                    <td class="property-name">操作</td>
                                    <!-- 操作按钮将由JavaScript动态添加 -->
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="compare-actions">
                    <button class="compare-action-btn" id="printCompare">
                        <i class="fas fa-print"></i>
                        <span>打印对比</span>
                    </button>
                    <button class="compare-action-btn" id="shareCompare">
                        <i class="fas fa-share-alt"></i>
                        <span>分享对比</span>
                    </button>
                    <button class="compare-action-btn primary" id="backToList">
                        <i class="fas fa-list"></i>
                        <span>返回列表</span>
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- 引入主JavaScript文件 -->
    <script src="../app/js/main.js"></script>
    <!-- 引入应用程序交互脚本 -->
    <script src="../app/js/app.js"></script>
    <!-- 引入Web端特有脚本 -->
    <script src="js/web-app.js"></script>
    <!-- 引入JavaScript文件 -->
    <script src="js/main.js"></script>
    <script src="js/components.js"></script>
    <script src="js/role-switch.js"></script>
    <script src="js/trade-hall.js"></script>
    <!-- 引入批注组件 -->
    <script src="js/annotation.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const compareNotice = document.getElementById('compareNotice');
            const compareTableWrapper = document.getElementById('compareTableWrapper');
            const compareTable = document.getElementById('compareTable');
            const printCompare = document.getElementById('printCompare');
            const shareCompare = document.getElementById('shareCompare');
            const backToList = document.getElementById('backToList');

            // 获取URL参数
            function getUrlParams() {
                const params = {};
                const queryString = window.location.search.substring(1);
                const pairs = queryString.split('&');
                for (const pair of pairs) {
                    const [key, value] = pair.split('=');
                    params[decodeURIComponent(key)] = decodeURIComponent(value || '');
                }
                return params;
            }

            // 获取URL中的产品ID参数
            const params = getUrlParams();
            const productIds = params.products ? params.products.split(',') : [];

            // 如果没有产品ID，显示提示
            if (productIds.length === 0) {
                compareNotice.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <span>未找到需要对比的产品，请先<a href="supply.html">选择产品</a>进行对比。</span>
                `;
                return;
            }

            // 模拟产品数据 - 实际应用中应从服务器获取
            const productData = {
                'product1': {
                    name: '山东烟台红富士苹果',
                    image: 'images/product1.jpg',
                    price: '¥6.5/斤',
                    seller: '烟台果园',
                    origin: '山东烟台',
                    spec: '85mm以上',
                    inventory: '10000斤',
                    minOrder: '5斤',
                    supply: '常年供应',
                    shipFrom: '山东烟台',
                    updateTime: '2023-07-20',
                    description: '烟台红富士苹果，色泽鲜艳，口感脆甜，果肉细腻，富含维生素，现摘现发，品质保证。',
                    certifications: ['包邮', '7天退换']
                },
                'product2': {
                    name: '有机蔬菜礼盒装',
                    image: 'images/product2.jpg',
                    price: '¥168/箱',
                    seller: '绿色农场',
                    origin: '北京顺义',
                    spec: '8种蔬菜/箱',
                    inventory: '500箱',
                    minOrder: '1箱',
                    supply: '常年供应',
                    shipFrom: '北京顺义',
                    updateTime: '2023-07-25',
                    description: '无农药、无化肥，有机认证，含8种时令蔬菜，每周定期配送，营养健康又新鲜。',
                    certifications: ['有机认证', '全国配送']
                },
                'product3': {
                    name: '五常稻花香大米',
                    image: 'images/product3.jpg',
                    price: '¥98/10斤',
                    seller: '五常米业',
                    origin: '黑龙江五常',
                    spec: '10斤/袋',
                    inventory: '10000袋',
                    minOrder: '1袋',
                    supply: '常年供应',
                    shipFrom: '黑龙江哈尔滨',
                    updateTime: '2023-07-18',
                    description: '东北黑土地种植，颗粒饱满，香糯可口，2022年新米，真空包装，保证新鲜。',
                    certifications: ['地理标志', '7天退换']
                },
                'product4': {
                    name: '陕西眉县猕猴桃',
                    image: 'images/product4.jpg',
                    price: '¥89/10斤',
                    seller: '眉县果农',
                    origin: '陕西眉县',
                    spec: '单果90g以上',
                    inventory: '5000斤',
                    minOrder: '10斤',
                    supply: '季节性供应',
                    shipFrom: '陕西宝鸡',
                    updateTime: '2023-07-28',
                    description: '富含维C，果肉鲜嫩，酸甜可口，产地直发，现摘现发，保证新鲜度，支持货到付款。',
                    certifications: ['包邮', '产地直发']
                }
            };

            // 获取要对比的产品数据
            const productsToCompare = productIds.filter(id => productData[id]).map(id => ({
                id,
                ...productData[id]
            }));

            // 如果没有找到产品数据，显示提示
            if (productsToCompare.length === 0) {
                compareNotice.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <span>未找到产品数据，请重新<a href="supply.html">选择产品</a>进行对比。</span>
                `;
                return;
            }

            // 显示对比表格
            compareNotice.style.display = 'none';
            compareTableWrapper.style.display = 'block';

            // 添加表头产品列
            const headerRow = compareTable.querySelector('thead tr');
            productsToCompare.forEach(product => {
                const th = document.createElement('th');
                th.className = 'product-header';
                th.innerHTML = `
                    <div class="product-header-content">
                        <span class="product-header-name">${product.name}</span>
                        <button class="remove-product" data-id="${product.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                headerRow.appendChild(th);
            });

            // 填充产品名称行
            const nameRow = compareTable.querySelectorAll('tbody tr')[1];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.name;
                nameRow.appendChild(td);
            });

            // 填充产品图片行
            const imageRow = compareTable.querySelectorAll('tbody tr')[2];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.innerHTML = `<img src="${product.image}" alt="${product.name}" class="compare-product-image">`;
                imageRow.appendChild(td);
            });

            // 填充价格行
            const priceRow = compareTable.querySelectorAll('tbody tr')[3];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.className = 'highlight';
                td.textContent = product.price;
                priceRow.appendChild(td);
            });

            // 填充卖家行
            const sellerRow = compareTable.querySelectorAll('tbody tr')[4];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.seller;
                sellerRow.appendChild(td);
            });

            // 填充产地行
            const originRow = compareTable.querySelectorAll('tbody tr')[6];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.origin;
                originRow.appendChild(td);
            });

            // 填充规格行
            const specRow = compareTable.querySelectorAll('tbody tr')[7];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.spec;
                specRow.appendChild(td);
            });

            // 填充库存行
            const inventoryRow = compareTable.querySelectorAll('tbody tr')[8];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.inventory;
                inventoryRow.appendChild(td);
            });

            // 填充起订量行
            const minOrderRow = compareTable.querySelectorAll('tbody tr')[9];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.minOrder;
                minOrderRow.appendChild(td);
            });

            // 填充供应周期行
            const supplyRow = compareTable.querySelectorAll('tbody tr')[10];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.supply;
                supplyRow.appendChild(td);
            });

            // 填充发货地行
            const shipFromRow = compareTable.querySelectorAll('tbody tr')[11];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.shipFrom;
                shipFromRow.appendChild(td);
            });

            // 填充更新时间行
            const updateTimeRow = compareTable.querySelectorAll('tbody tr')[12];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.updateTime;
                updateTimeRow.appendChild(td);
            });

            // 填充产品描述行
            const descriptionRow = compareTable.querySelectorAll('tbody tr')[14];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.textContent = product.description;
                descriptionRow.appendChild(td);
            });

            // 填充认证标签行
            const certificationsRow = compareTable.querySelectorAll('tbody tr')[15];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.innerHTML = product.certifications.map(cert =>
                    `<span class="compare-badge">${cert}</span>`
                ).join('');
                certificationsRow.appendChild(td);
            });

            // 填充操作行
            const actionsRow = compareTable.querySelectorAll('tbody tr')[16];
            productsToCompare.forEach(product => {
                const td = document.createElement('td');
                td.innerHTML = `
                    <div class="compare-actions-cell">
                        <button class="contact-btn" title="发送消息">
                            <i class="fas fa-comment"></i>
                        </button>
                        <button class="contact-btn primary" title="电话联系">
                            <i class="fas fa-phone-alt"></i>
                        </button>
                    </div>
                `;
                actionsRow.appendChild(td);
            });

            // 设置类别标题的colspan值
            const categoryHeaders = compareTable.querySelectorAll('.category-header td');
            categoryHeaders.forEach(header => {
                header.setAttribute('colspan', productsToCompare.length + 1);
            });

            // 移除产品事件处理
            const removeButtons = compareTable.querySelectorAll('.remove-product');
            removeButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const productId = this.getAttribute('data-id');
                    const newProductIds = productIds.filter(id => id !== productId);

                    if (newProductIds.length < 2) {
                        // 如果只剩下1个产品，重定向回列表页
                        window.location.href = 'supply.html';
                    } else {
                        // 重新加载带有新产品ID列表的对比页面
                        window.location.href = `compare.html?products=${newProductIds.join(',')}`;
                    }
                });
            });

            // 打印对比事件处理
            if (printCompare) {
                printCompare.addEventListener('click', function () {
                    window.print();
                });
            }

            // 返回列表事件处理
            if (backToList) {
                backToList.addEventListener('click', function () {
                    window.location.href = 'supply.html';
                });
            }

            // 分享对比事件处理
            if (shareCompare) {
                shareCompare.addEventListener('click', function () {
                    // 在实际应用中，这里应该实现分享功能
                    // 这里只是一个简单的示例，复制当前URL到剪贴板
                    const tempInput = document.createElement('input');
                    tempInput.value = window.location.href;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);

                    alert('对比链接已复制到剪贴板！');
                });
            }
        });
    </script>
</body>
