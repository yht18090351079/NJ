<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发布需求信息 - 农产品供销信息平台</title>
    <meta name="description" content="发布农产品采购需求信息，寻找优质供应商">
    <meta name="keywords" content="农产品,需求,采购,农产品需求">
    <meta name="theme-color" content="#2E8B57">

    <!-- 引入字体图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css">
    <!-- 引入自定义样式 -->
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* 发布表单样式 */
        .publish-form-section {
            padding: var(--spacing-lg);
            max-width: 1000px;
            margin: 0 auto;
            min-height: calc(100vh - 300px);
        }

        .form-card {
            background-color: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        .form-title {
            font-size: 20px;
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .form-title i {
            color: var(--primary-color);
        }

        .btn-text {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            padding: 4px 8px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .btn-text:hover {
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
        }

        .required::after {
            content: '*';
            color: #F44336;
            margin-left: 4px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(46, 139, 87, 0.2);
            outline: none;
        }

        /* 验证样式 */
        .form-input.valid,
        .form-select.valid,
        .form-textarea.valid {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.05);
        }

        .form-input.invalid,
        .form-select.invalid,
        .form-textarea.invalid {
            border-color: #F44336;
            background-color: rgba(244, 67, 54, 0.05);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-help {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .input-group {
            display: flex;
            gap: var(--spacing-md);
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            min-height: 42px;
        }

        .tag {
            display: flex;
            align-items: center;
            background-color: #E8F5E9;
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
        }

        .tag i {
            margin-left: 6px;
            font-size: 12px;
            cursor: pointer;
            opacity: 0.7;
        }

        .tag i:hover {
            opacity: 1;
        }

        .tag-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 14px;
            min-width: 120px;
            color: var(--text-primary);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--spacing-xl);
        }

        .form-actions-right {
            display: flex;
            gap: var(--spacing-md);
        }

        .btn-back-styled {
            background-color: #f5f5f5;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }

        .btn-back-styled:hover {
            background-color: #e0e0e0;
            color: var(--text-primary);
        }

        .btn-submit {
            padding: var(--spacing-md) 24px;
            font-size: 16px;
            font-weight: 500;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-draft {
            background-color: var(--white);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-draft:hover {
            background-color: #f0f9f4;
        }

        .btn-publish {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .btn-publish:hover {
            background-color: #236b4a;
        }

        /* 搜索下拉框样式 */
        .search-select-container {
            position: relative;
        }

        /* 修改dropdown-icon样式确保可点击 */
        .dropdown-icon {
            display: none !important;
            /* 隐藏旧的图标 */
        }

        /* 输入框右侧留出空间给箭头 */
        .search-select-container .form-input {
            padding-right: 40px !important;
            cursor: pointer !important;
        }

        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-height: 240px;
            overflow-y: auto;
            margin-top: 4px;
            padding: 4px 0;
        }

        .search-dropdown-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            color: var(--text-primary);
        }

        .search-dropdown-item:hover {
            background-color: #f5f5f5;
            color: var(--primary-color);
        }

        .search-dropdown-item+.search-dropdown-item {
            border-top: 1px solid #f0f0f0;
        }

        /* 美化滚动条 */
        .search-dropdown::-webkit-scrollbar {
            width: 6px;
        }

        .search-dropdown::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .search-dropdown::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .search-dropdown::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* 输入框禁用状态 */
        .form-input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
            color: #999;
        }

        /* 提示文字样式 */
        .input-tip {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
            margin-left: 4px;
        }

        /* 预设标签样式 */
        .preset-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .preset-tag {
            display: inline-block;
            padding: 4px 12px;
            background-color: #f0f0f0;
            border-radius: 16px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .preset-tag:hover {
            background-color: #E8F5E9;
            color: var(--primary-color);
        }

        /* 确认弹窗样式 */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .confirm-modal.show {
            display: flex;
        }

        .confirm-dialog {
            background: white;
            border-radius: 8px;
            padding: 24px;
            width: 400px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .confirm-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .confirm-header i {
            font-size: 24px;
            color: var(--primary-color);
            margin-right: 12px;
        }

        .confirm-title {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
            margin: 0;
        }

        .confirm-content {
            color: var(--text-secondary);
            margin-bottom: 24px;
            font-size: 14px;
            line-height: 1.5;
        }

        .confirm-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .confirm-btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .confirm-btn-cancel {
            background: #f5f5f5;
            color: var(--text-secondary);
        }

        .confirm-btn-cancel:hover {
            background: #e8e8e8;
        }

        .confirm-btn-confirm {
            background: var(--primary-color);
            color: white;
        }

        .confirm-btn-confirm:hover {
            background: #236b4a;
        }

        /* 重新设计下拉箭头样式 */
        .arrow-icon {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer !important;
            z-index: 100 !important;
            transition: all 0.3s ease;
            border-top-right-radius: var(--radius-md);
            border-bottom-right-radius: var(--radius-md);
            background-color: rgba(0, 0, 0, 0.05);
            pointer-events: auto !important;
        }

        .arrow-icon:after {
            content: '';
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid currentColor;
            transition: transform 0.3s ease;
        }

        .arrow-icon:hover {
            background-color: rgba(0, 0, 0, 0.08);
            color: var(--primary-color);
        }

        .search-select-container.active .arrow-icon:after {
            transform: rotate(180deg);
        }

        /* 重新设计下拉菜单样式 */
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            margin-top: 4px;
        }

        .search-dropdown-item {
            padding: 10px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .search-dropdown-item:last-child {
            border-bottom: none;
        }

        .search-dropdown-item:hover {
            background-color: #f0f8f4;
            color: var(--primary-color);
        }

        /* 优化搜索选择容器样式 */
        .search-select-container {
            position: relative;
            margin-bottom: 8px;
        }

        .search-select-wrap {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .search-selected {
            position: relative;
            width: 100%;
        }

        .search-selected input {
            padding-right: 40px;
            cursor: pointer;
            width: 100%;
            background-color: white;
        }

        /* 响应式调整 */
        @media (min-width: 768px) {
            .search-select-wrap {
                flex-wrap: nowrap;
            }
        }

        /* 添加旋转加载样式 */
        .ri-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* 按钮禁用状态 */
        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <!-- Web应用布局 -->
    <div class="web-layout">
        <!-- 顶部导航栏 -->
        <header class="web-header">
            <!-- 水平导航菜单 -->
            <nav class="horizontal-nav">
                <div class="horizontal-nav-menu">
                    <!-- Logo -->
                    <div class="logo">
                        <img src="https://img.icons8.com/color/96/null/natural-food.png" alt="农产品供销信息平台">
                        <span class="logo-text">农产品供销平台</span>
                    </div>

                    <!-- 导航链接 -->
                    <div class="nav-links">
                        <div class="horizontal-nav-item">
                            <a href="index.html" class="horizontal-nav-link">
                                <i class="fas fa-home"></i>
                                <span>首页</span>
                            </a>
                        </div>
                        <div class="horizontal-nav-item" id="supplyHallLink">
                            <a href="supply.html" class="horizontal-nav-link">
                                <i class="fas fa-store"></i>
                                <span>供应大厅</span>
                            </a>
                        </div>
                        <div class="horizontal-nav-item" id="demandHallLink" style="display: none;">
                            <a href="demand.html" class="horizontal-nav-link">
                                <i class="fas fa-shopping-cart"></i>
                                <span>需求大厅</span>
                            </a>
                        </div>
                        <div class="horizontal-nav-item">
                            <a href="publish.html" class="horizontal-nav-link active">
                                <i class="fas fa-edit"></i>
                                <span>发布信息</span>
                            </a>
                        </div>

                        <div class="nav-group-divider"></div>

                        <div class="horizontal-nav-item">
                            <a href="policy.html" class="horizontal-nav-link">
                                <i class="fas fa-newspaper"></i>
                                <span>消息快报</span>
                            </a>
                        </div>
                    </div>

                    <!-- 用户区域 -->
                    <div class="header-icons">
                        <div class="role-switch">
                            <i class="fas fa-exchange-alt"></i>
                            <span id="currentRole">采购商</span>
                        </div>
                        <a href="user.html" class="avatar-wrapper">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="用户头像">
                        </a>
                    </div>
                </div>
            </nav>
        </header>

        <!-- 主要内容区域 -->
        <main class="page-content">
            <!-- 面包屑导航 -->
            <div class="breadcrumb">
                <a href="index.html" class="breadcrumb-item">
                    <i class="ri-home-line"></i>
                    <span>首页</span>
                </a>
                <i class="ri-arrow-right-s-line"></i>
                <a href="publish.html" class="breadcrumb-item">
                    <span>发布信息</span>
                </a>
                <i class="ri-arrow-right-s-line"></i>
                <span class="breadcrumb-item active">发布需求</span>
            </div>

            <!-- 发布表单区域 -->
            <section class="publish-form-section">
                <div class="form-card">
                    <div class="form-header">
                        <h2 class="form-title">
                            <i class="ri-shopping-cart-line"></i>
                            <span>发布采购需求</span>
                        </h2>
                        <div>
                            <button type="button" class="btn-text" onclick="javascript:
                                console.log('直接填充测试数据');
                                // 设置分类
                                document.getElementById('demandTitleInput').value = '寻找优质新鲜番茄供应商';
                                document.getElementById('categoryLevel1Input').value = '蔬菜';
                                document.getElementById('categoryLevel2Input').value = '茄果类';
                                document.getElementById('categoryLevel3Input').disabled = false;
                                document.getElementById('categoryLevel3Input').value = '番茄';
                                
                                // 设置品名
                                document.getElementById('productNameInput').value = '大红番茄';
                                
                                // 设置省市区
                                document.getElementById('provinceInput').value = '湖北省';
                                document.getElementById('cityInput').disabled = false;
                                document.getElementById('cityInput').value = '武汉市';
                                document.getElementById('districtInput').disabled = false;
                                document.getElementById('districtInput').value = '洪山区';
                                
                                // 设置价格和数量
                                document.getElementById('priceInput').value = '2.5';
                                document.getElementById('priceUnitSelect').value = 'yuan-per-jin';
                                document.getElementById('quantityInput').value = '1000';
                                document.getElementById('quantityUnitSelect').value = 'jin';
                                
                                // 设置要求和地址
                                document.getElementById('requirementsInput').value = '需要新鲜度高，无病虫害，色泽鲜艳的番茄。直径要求6-8cm，单果重约150-200g。';
                                document.getElementById('deliveryAddressInput').value = '湖北省武汉市洪山区珞喻路1037号';
                                
                                // 设置日期
                                const today = new Date();
                                const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                                const year = nextWeek.getFullYear();
                                const month = String(nextWeek.getMonth() + 1).padStart(2, '0');
                                const day = String(nextWeek.getDate()).padStart(2, '0');
                                document.getElementById('deliveryTimeInput').value = `${year}-${month}-${day}`;
                                
                                // 设置联系方式
                                document.getElementById('contactNameInput').value = '张先生';
                                document.getElementById('contactPhoneInput').value = '13812345678';
                                document.getElementById('wechatInput').value = 'zhang_veggies';
                                
                                // 标记表单已修改
                                window.formModified = true;
                                console.log('测试数据填充完成');
                                return false;">
                                <i class="ri-magic-line"></i>
                                <span>填充测试数据</span>
                            </button>
                        </div>
                    </div>

                    <form id="publishForm">
                        <!-- 需求标题 -->
                        <div class="form-group">
                            <label class="form-label required">需求标题</label>
                            <input type="text" class="form-input" id="demandTitleInput" placeholder="请输入需求标题，简洁明了">
                            <div class="form-help">例如：急需优质红富士苹果 或 寻找新鲜湖北莲藕</div>
                        </div>

                        <!-- 基本信息 -->
                        <div class="form-group">
                            <label class="form-label required">采购品类</label>
                            <div class="input-group">
                                <div class="search-select-container" style="flex: 1;" id="categoryLevel1Container">
                                    <div class="search-selected">
                                        <input type="text" class="form-input" id="categoryLevel1Input"
                                            placeholder="请输入或选择一级分类" readonly
                                            onclick="return toggleDropdown(this, event)">
                                        <span class="arrow-icon" onclick="return toggleDropdown(this, event)"></span>
                                    </div>
                                    <div class="search-dropdown" id="categoryLevel1Dropdown" style="display: none;">
                                        <!-- 下拉选项由JavaScript动态添加 -->
                                    </div>
                                </div>
                                <div class="search-select-container" style="flex: 1;" id="categoryLevel2Container">
                                    <div class="search-selected">
                                        <input type="text" class="form-input" id="categoryLevel2Input"
                                            placeholder="请输入或选择二级分类" readonly
                                            onclick="return toggleDropdown(this, event)">
                                        <span class="arrow-icon" onclick="return toggleDropdown(this, event)"></span>
                                    </div>
                                    <div class="search-dropdown" id="categoryLevel2Dropdown" style="display: none;">
                                        <!-- 下拉选项由JavaScript动态添加 -->
                                    </div>
                                </div>
                                <div class="search-select-container" style="flex: 1;" id="categoryLevel3Container">
                                    <div class="search-selected">
                                        <input type="text" class="form-input" id="categoryLevel3Input"
                                            placeholder="请输入或选择三级分类" readonly
                                            onclick="return toggleDropdown(this, event)">
                                        <span class="arrow-icon" onclick="return toggleDropdown(this, event)"></span>
                                    </div>
                                    <div class="search-dropdown" id="categoryLevel3Dropdown" style="display: none;">
                                        <!-- 下拉选项由JavaScript动态添加 -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">具体品名</label>
                            <input type="text" class="form-input" id="productNameInput" placeholder="请输入具体品名或品种（选填）">
                            <div class="form-help">例如：洛川苹果、富士王、晚秋黄梨等</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">收货地区</label>
                            <div class="input-group">
                                <div class="search-select-container" style="flex: 1;" id="provinceContainer">
                                    <div class="search-selected">
                                        <input type="text" class="form-input" id="provinceInput" placeholder="请选择省份"
                                            readonly onclick="return toggleDropdown(this, event)">
                                        <span class="arrow-icon" onclick="return toggleDropdown(this, event)"></span>
                                    </div>
                                    <div class="search-dropdown" id="provinceDropdown" style="display: none;">
                                        <!-- 下拉选项由JavaScript动态添加 -->
                                    </div>
                                </div>
                                <div class="search-select-container" style="flex: 1;" id="cityContainer">
                                    <div class="search-selected">
                                        <input type="text" class="form-input" id="cityInput" placeholder="请选择城市"
                                            readonly onclick="return toggleDropdown(this, event)">
                                        <span class="arrow-icon" onclick="return toggleDropdown(this, event)"></span>
                                    </div>
                                    <div class="search-dropdown" id="cityDropdown" style="display: none;">
                                        <!-- 下拉选项由JavaScript动态添加 -->
                                    </div>
                                </div>
                                <div class="search-select-container" style="flex: 1;" id="districtContainer">
                                    <div class="search-selected">
                                        <input type="text" class="form-input" id="districtInput" placeholder="请选择区县"
                                            readonly onclick="return toggleDropdown(this, event)">
                                        <span class="arrow-icon" onclick="return toggleDropdown(this, event)"></span>
                                    </div>
                                    <div class="search-dropdown" id="districtDropdown" style="display: none;">
                                        <!-- 下拉选项由JavaScript动态添加 -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 产品特征 -->
                        <div class="form-group">
                            <label class="form-label">产品特性要求</label>
                            <div class="preset-tags">
                                <span class="preset-tag">有机认证</span>
                                <span class="preset-tag">绿色食品</span>
                                <span class="preset-tag">无公害</span>
                                <span class="preset-tag">地理标志</span>
                                <span class="preset-tag">新鲜采摘</span>
                                <span class="preset-tag">冷链配送</span>
                            </div>
                            <div class="tags-input" id="tagsContainer">
                                <input type="text" class="tag-input" id="tagInput" placeholder="输入自定义特性并回车添加">
                            </div>
                            <div class="form-help">点击预设特性或输入自定义特性</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">预期价格</label>
                            <div class="input-group">
                                <input type="number" class="form-input" id="priceInput" placeholder="请输入预期价格"
                                    step="0.01" min="0.01" style="flex: 2;">
                                <select class="form-select" id="priceUnitSelect" style="flex: 1;">
                                    <option value="yuan-per-jin">元/斤</option>
                                    <option value="yuan-per-kg">元/公斤</option>
                                    <option value="yuan-per-500g">元/500g</option>
                                    <option value="yuan-per-ton">元/吨</option>
                                </select>
                            </div>
                            <div class="input-tip">注：如有价格区间要求，请在质量要求中说明</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">采购数量</label>
                            <div class="input-group">
                                <input type="number" class="form-input" id="quantityInput" placeholder="请输入采购数量" min="1"
                                    style="flex: 2;">
                                <select class="form-select" id="quantityUnitSelect" style="flex: 1;">
                                    <option value="jin">斤</option>
                                    <option value="kg">公斤</option>
                                    <option value="ton">吨</option>
                                    <option value="package">箱/包</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">质量要求</label>
                            <textarea class="form-textarea" id="requirementsInput"
                                placeholder="请描述对产品的质量、规格等要求"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">收货地址</label>
                            <input type="text" class="form-input" id="deliveryAddressInput" placeholder="请输入详细收货地址">
                        </div>

                        <div class="form-group">
                            <label class="form-label required">期望到货时间</label>
                            <input type="date" class="form-input" id="deliveryTimeInput">
                        </div>

                        <!-- 联系方式 -->
                        <div class="form-group">
                            <label class="form-label required">联系人</label>
                            <input type="text" class="form-input" id="contactNameInput" placeholder="请输入联系人姓名">
                        </div>

                        <div class="form-group">
                            <label class="form-label required">联系电话</label>
                            <input type="tel" class="form-input" id="contactPhoneInput" placeholder="请输入联系电话">
                        </div>

                        <div class="form-group">
                            <label class="form-label">微信号</label>
                            <input type="text" class="form-input" id="wechatInput" placeholder="请输入微信号（选填）">
                        </div>

                        <!-- 表单操作 -->
                        <div class="form-actions">
                            <button type="button" class="btn-submit btn-back-styled" id="backBtn"
                                onclick="goBack(); return false;">
                                <i class="ri-arrow-left-line"></i>
                                <span>返回</span>
                            </button>
                            <div class="form-actions-right">
                                <button type="button" class="btn-submit btn-draft" id="saveDraftBtn"
                                    onclick="saveDraft(); return false;">保存草稿</button>
                                <button type="button" class="btn-submit btn-publish" id="publishBtn" onclick="javascript:
                                    console.log('立即发布按钮被点击');
                                    // 验证所有必填字段
                                    const requiredFields = [
                                        { id: 'demandTitleInput', name: '信息标题' },
                                        { id: 'categoryLevel1Input', name: '一级分类' },
                                        { id: 'categoryLevel2Input', name: '二级分类' },
                                        { id: 'categoryLevel3Input', name: '三级分类' },
                                        { id: 'provinceInput', name: '省份' },
                                        { id: 'cityInput', name: '城市' },
                                        { id: 'districtInput', name: '区县' },
                                        { id: 'priceInput', name: '预期价格' },
                                        { id: 'quantityInput', name: '采购数量' },
                                        { id: 'requirementsInput', name: '质量要求' },
                                        { id: 'deliveryAddressInput', name: '收货地址' },
                                        { id: 'deliveryTimeInput', name: '期望到货时间' },
                                        { id: 'contactNameInput', name: '联系人' },
                                        { id: 'contactPhoneInput', name: '联系电话' }
                                    ];
                                    
                                    // 检查是否有空字段
                                    let emptyFields = [];
                                    for(let field of requiredFields) {
                                        const element = document.getElementById(field.id);
                                        if (element && element.value.trim() === '') {
                                            emptyFields.push(field.name);
                                        }
                                    }
                                    
                                    // 检查数字字段是否有效
                                    const numberFields = [
                                        { id: 'priceInput', name: '预期价格' },
                                        { id: 'quantityInput', name: '采购数量' }
                                    ];
                                    
                                    let invalidNumberFields = [];
                                    for(let field of numberFields) {
                                        const element = document.getElementById(field.id);
                                        if (element) {
                                            const value = parseFloat(element.value);
                                            if (isNaN(value) || value <= 0) {
                                                invalidNumberFields.push(field.name);
                                            }
                                        }
                                    }
                                    
                                    // 如果有错误，显示提示
                                    if (emptyFields.length > 0 || invalidNumberFields.length > 0) {
                                        let message = '';
                                        
                                        if (emptyFields.length > 0) {
                                            message += '请填写以下必填字段：' + emptyFields.join('、');
                                        }
                                        
                                        if (invalidNumberFields.length > 0) {
                                            if (message) message += '\n\n';
                                            message += '以下数字字段必须为大于0的有效数字：' + invalidNumberFields.join('、');
                                        }
                                        
                                        alert(message);
                                        return false;
                                    }
                                    
                                    // 如果所有字段都有效，显示确认弹窗
                                    document.getElementById('publishModal').classList.add('show');
                                    return false;">立即发布</button>
                            </div>
                        </div>
                    </form>
                </div>
            </section>

        </main>

        <!-- 页脚区域 -->
        <div data-component="footer"></div>
    </div>

    <!-- 确认弹窗 -->
    <div class="confirm-modal" id="publishModal">
        <div class="confirm-dialog">
            <div class="confirm-header">
                <i class="ri-file-paper-2-line"></i>
                <h3 class="confirm-title">确认发布</h3>
            </div>
            <div class="confirm-content">
                您确定要发布这条采购需求吗？发布后将进入系统审核，审核通过后会在需求大厅展示。
            </div>
            <div class="confirm-actions">
                <button class="confirm-btn confirm-btn-cancel" id="cancelPublishBtn"
                    onclick="document.getElementById('publishModal').classList.remove('show');">取消</button>
                <button class="confirm-btn confirm-btn-confirm" id="confirmPublishBtn" onclick="(function(btn){
                    btn.disabled = true;
                    btn.innerHTML = '<i class=\'ri-loader-line ri-spin\'></i> 提交中...';
                    setTimeout(function() {
                        document.getElementById('publishModal').classList.remove('show');
                        setTimeout(function() {
                            document.getElementById('successModal').classList.add('show');
                            btn.disabled = false;
                            btn.innerHTML = '确认发布';
                            window.formModified = false;
                        }, 500);
                    }, 1500);
                })(this);">确认发布</button>
            </div>
        </div>
    </div>

    <!-- 草稿确认弹窗 -->
    <div class="confirm-modal" id="draftModal">
        <div class="confirm-dialog">
            <div class="confirm-header">
                <i class="ri-draft-line"></i>
                <h3 class="confirm-title">保存草稿</h3>
            </div>
            <div class="confirm-content">
                确定要将当前内容保存为草稿吗？您可以稍后在发布管理中继续编辑。
            </div>
            <div class="confirm-actions">
                <button class="confirm-btn confirm-btn-cancel" id="cancelDraftBtn"
                    onclick="document.getElementById('draftModal').classList.remove('show');">取消</button>
                <button class="confirm-btn confirm-btn-confirm" id="confirmDraftBtn"
                    onclick="document.getElementById('draftModal').classList.remove('show'); window.location.href = 'publish.html';">确认保存</button>
            </div>
        </div>
    </div>

    <!-- 返回确认弹窗 -->
    <div class="confirm-modal" id="goBackModal">
        <div class="confirm-dialog">
            <div class="confirm-header">
                <i class="ri-alert-line"></i>
                <h3 class="confirm-title">确认返回</h3>
            </div>
            <div class="confirm-content">
                您已修改了表单内容，是否在返回前保存为草稿？
            </div>
            <div class="confirm-actions">
                <button class="confirm-btn confirm-btn-cancel" id="directReturnBtn"
                    onclick="document.getElementById('goBackModal').classList.remove('show'); window.location.href = 'publish.html';">直接返回</button>
                <button class="confirm-btn confirm-btn-confirm" id="saveAndReturnBtn"
                    onclick="saveDraft(); document.getElementById('goBackModal').classList.remove('show'); window.location.href = 'publish.html';">保存草稿</button>
            </div>
        </div>
    </div>

    <!-- 角色切换弹窗 -->
    <div class="confirm-modal role-modal">
        <div class="confirm-dialog" style="width: 450px;">
            <div class="confirm-header">
                <i class="fas fa-exchange-alt"></i>
                <h3 class="confirm-title">切换角色</h3>
            </div>
            <div class="confirm-content" style="padding: 15px 0;">
                <div class="role-options" style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <div class="role-option" data-role="supplier"
                        style="flex: 1; border: 1px solid #eee; border-radius: 8px; padding: 15px; cursor: pointer;">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <i class="fas fa-store"
                                style="color: var(--primary-color); margin-right: 10px; font-size: 18px;"></i>
                            <h4 style="margin: 0; font-size: 16px;">供应商</h4>
                        </div>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">发布农产品供应信息</p>
                    </div>
                    <div class="role-option active" data-role="buyer"
                        style="flex: 1; border: 1px solid #eee; border-radius: 8px; padding: 15px; cursor: pointer;">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <i class="fas fa-shopping-cart"
                                style="color: var(--primary-color); margin-right: 10px; font-size: 18px;"></i>
                            <h4 style="margin: 0; font-size: 16px;">采购商</h4>
                        </div>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">发布农产品采购需求</p>
                    </div>
                </div>
            </div>
            <div class="confirm-actions">
                <button class="confirm-btn confirm-btn-cancel" id="cancelRoleBtn">取消</button>
                <button class="confirm-btn confirm-btn-confirm role-confirm" id="confirmRoleBtn">确认切换</button>
            </div>
        </div>
    </div>

    <!-- 成功提示弹窗 -->
    <div class="confirm-modal" id="successModal">
        <div class="confirm-dialog">
            <div class="confirm-header">
                <i class="ri-check-line" style="color: var(--primary-color);"></i>
                <h3 class="confirm-title">发布成功</h3>
            </div>
            <div class="confirm-content">
                您的采购需求已提交成功！需求信息将在系统审核通过后，在需求大厅展示。
            </div>
            <div class="confirm-actions">
                <button class="confirm-btn confirm-btn-confirm" id="successBackBtn"
                    onclick="window.location.href='publish.html';">返回列表</button>
            </div>
        </div>
    </div>

    <!-- 引入各种脚本和模块 -->
    <script src="js/dropdown.js"></script>
    <script src="js/main.js"></script>
    <script src="js/components.js"></script>
    <script>
        // 先定义saveDraft函数，确保在页面任何地方都可以调用
        function saveDraft() {
            console.log('保存草稿函数被调用');
            try {
                // 收集表单数据
                const formData = {
                    title: document.getElementById('demandTitleInput')?.value || '',
                    category: {
                        level1: document.getElementById('categoryLevel1Input')?.value || '',
                        level2: document.getElementById('categoryLevel2Input')?.value || '',
                        level3: document.getElementById('categoryLevel3Input')?.value || ''
                    },
                    productName: document.getElementById('productNameInput')?.value || '',
                    location: {
                        province: document.getElementById('provinceInput')?.value || '',
                        city: document.getElementById('cityInput')?.value || '',
                        district: document.getElementById('districtInput')?.value || ''
                    },
                    price: document.getElementById('priceInput')?.value || '',
                    priceUnit: document.getElementById('priceUnitSelect')?.value || '',
                    quantity: {
                        value: document.getElementById('quantityInput')?.value || '',
                        unit: document.getElementById('quantityUnitSelect')?.value || ''
                    },
                    requirements: document.getElementById('requirementsInput')?.value || '',
                    deliveryAddress: document.getElementById('deliveryAddressInput')?.value || '',
                    deliveryTime: document.getElementById('deliveryTimeInput')?.value || '',
                    contactName: document.getElementById('contactNameInput')?.value || '',
                    contact: document.getElementById('contactPhoneInput')?.value || '',
                    wechat: document.getElementById('wechatInput')?.value || '',
                    tags: Array.from(document.querySelectorAll('#tagsContainer .tag') || []).map(tag =>
                        tag.textContent.replace(/\s*×\s*$/, '').trim()
                    )
                };

                // 保存到本地存储
                localStorage.setItem('demandDraft', JSON.stringify(formData));
                window.formModified = false;

                // 显示保存成功弹窗
                const draftModal = document.getElementById('draftModal');
                if (draftModal) {
                    draftModal.classList.add('show');
                } else {
                    alert('草稿保存成功！');
                }

                console.log('草稿保存成功');
            } catch (error) {
                console.error('保存草稿失败:', error);
                alert('保存草稿失败，请重试：' + error.message);
            }
        }

        // 全局变量声明
        window.formModified = false;

        // 添加调试日志
        console.log('脚本开始加载...');

        // 加载草稿数据
        function loadDraftData() {
            const draftData = localStorage.getItem('demandDraft');
            if (draftData) {
                try {
                    const data = JSON.parse(draftData);

                    // 设置标题
                    if (data.title) document.getElementById('demandTitleInput').value = data.title;

                    // 设置分类
                    if (data.category) {
                        if (data.category.level1) {
                            document.getElementById('categoryLevel1Input').value = data.category.level1;
                            updateCategory2Options(data.category.level1);
                        }
                        if (data.category.level2) {
                            document.getElementById('categoryLevel2Input').value = data.category.level2;
                            document.getElementById('categoryLevel2Input').disabled = false;
                            updateCategory3Options(data.category.level1, data.category.level2);
                        }
                        if (data.category.level3) {
                            document.getElementById('categoryLevel3Input').value = data.category.level3;
                            document.getElementById('categoryLevel3Input').disabled = false;
                        }
                    }

                    // 设置品名
                    if (data.productName) document.getElementById('productNameInput').value = data.productName;

                    // 设置省市区
                    if (data.location) {
                        if (data.location.province) {
                            document.getElementById('provinceInput').value = data.location.province;
                            updateCityOptions(data.location.province);
                        }
                        if (data.location.city) {
                            document.getElementById('cityInput').value = data.location.city;
                            document.getElementById('cityInput').disabled = false;
                            updateDistrictOptions(data.location.province, data.location.city);
                        }
                        if (data.location.district) {
                            document.getElementById('districtInput').value = data.location.district;
                            document.getElementById('districtInput').disabled = false;
                        }
                    }

                    // 填充其他数据
                    if (data.price) document.getElementById('priceInput').value = data.price;
                    if (data.priceUnit) document.getElementById('priceUnitSelect').value = data.priceUnit;
                    if (data.quantity) {
                        if (data.quantity.value) document.getElementById('quantityInput').value = data.quantity.value;
                        if (data.quantity.unit) document.getElementById('quantityUnitSelect').value = data.quantity.unit;
                    }
                    if (data.requirements) document.getElementById('requirementsInput').value = data.requirements;
                    if (data.deliveryAddress) document.getElementById('deliveryAddressInput').value = data.deliveryAddress;
                    if (data.deliveryTime) document.getElementById('deliveryTimeInput').value = data.deliveryTime;
                    if (data.contactName) document.getElementById('contactNameInput').value = data.contactName;
                    if (data.contact) document.getElementById('contactPhoneInput').value = data.contact;
                    if (data.wechat) document.getElementById('wechatInput').value = data.wechat;

                    // 添加标签
                    if (data.tags && Array.isArray(data.tags)) {
                        // 清除现有标签
                        const tagsContainer = document.getElementById('tagsContainer');
                        const existingTags = tagsContainer.querySelectorAll('.tag');
                        existingTags.forEach(tag => tag.remove());

                        // 添加保存的标签
                        data.tags.forEach(tag => addTag(tag));
                    }

                    console.log('草稿数据加载完成');
                } catch (e) {
                    console.error('加载草稿数据失败:', e);
                }
            }
        }

        // 添加标签函数
        function addTag(text) {
            if (!text || text.trim() === '') return;

            // 检查是否已存在相同标签
            const tagsContainer = document.getElementById('tagsContainer');
            const existingTags = Array.from(tagsContainer.querySelectorAll('.tag')).map(tag =>
                tag.textContent.replace(/\s*×\s*$/, '').trim()
            );

            if (existingTags.includes(text)) {
                return; // 不添加重复标签
            }

            // 检查是否达到最大标签数量
            if (existingTags.length >= 5) {
                alert('最多添加5个标签');
                return;
            }

            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = text + ' <i class="fas fa-times"></i>';

            // 添加删除标签功能
            tag.querySelector('i').addEventListener('click', function () {
                tag.remove();
                formModified = true;
            });

            // 将标签添加到容器
            tagsContainer.insertBefore(tag, tagsContainer.querySelector('.tag-input'));
            formModified = true;
        }

        // 设置标签输入处理
        function setupTagInput() {
            const tagsContainer = document.getElementById('tagsContainer');
            const tagInput = tagsContainer.querySelector('.tag-input');

            // 处理输入事件
            tagInput.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' && this.value.trim()) {
                    e.preventDefault();
                    addTag(this.value.trim());
                    this.value = '';
                }
            });

            // 处理预设标签按钮
            document.querySelectorAll('.preset-tag').forEach(btn => {
                btn.addEventListener('click', function () {
                    const featureText = this.textContent.trim();
                    addTag(featureText);
                    this.classList.add('selected');
                });
            });
        }

        // 关闭弹窗
        window.closeModal = function (modalId) {
            document.getElementById(modalId).classList.remove('show');
        };

        // 定义goBack函数作为window属性使其在全局可访问
        window.goBack = function () {
            console.log('返回按钮被点击');
            if (window.formModified) {
                // 表单已修改，显示确认弹窗
                document.getElementById('goBackModal').classList.add('show');
            } else {
                // 表单未修改，直接返回
                window.location.href = 'publish.html';
            }
        };

        // 监听表单元素变化
        document.addEventListener('DOMContentLoaded', function () {
            console.log('添加表单变更监听器');
            // 为所有表单元素添加变更监听
            const formElements = document.querySelectorAll('#publishForm input, #publishForm textarea, #publishForm select');
            formElements.forEach(element => {
                element.addEventListener('input', function () {
                    window.formModified = true;
                    console.log('表单已修改');
                });
                element.addEventListener('change', function () {
                    window.formModified = true;
                    console.log('表单已修改');
                });
            });

            // 初始化标签输入
            setupTagInput();

            // 加载草稿数据
            loadDraftData();
        });
    </script>
</body>

</html>